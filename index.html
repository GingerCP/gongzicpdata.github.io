<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>长佩数据更新</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container">
    <h1 class="mt-4">📚 长佩数据更新</h1>

    <!-- Description Section -->
    <p class="lead">
        本页面展示了最新的小说数据，包括：
    </p>
    <ul>
        <li><strong>📖 播报：</strong> 每日00：10更新数据。</li>
        <li><strong>📖 必读：</strong> 每日00：10更新数据。</li>
        <li><strong>📖 首页所有数据、纯爱内页榜单数据：</strong> 每周五00:05更新数据。</li>
        <li><strong>📚 全站书籍：</strong> 每周五00:05更新数据，更新至榜单截止日期时全站耽美连载小说500条更新数据。可根据该数据库查找书架线。注意：本数据库抓取时间有十分钟延误</li>
        
    </ul>
    <p class="text-danger">
         <strong>Do not attack contributors at any social media in any ways. In that case I will delete the website. </strong> <br>
        <strong>Do not attack contributors at any social media in any ways. In that case I will delete the website. </strong> <br>
        <strong>Do not attack contributors at any social media in any ways. In that case I will delete the website. </strong> <br>
    </p>
        <p>
        数据会根据更新时间自动刷新（因为github action在00:00属于submit job的高峰期，虽然已经设置了sleep time, 但是仍然存在10-30分钟延迟），数据更新时间显示在表格中。<br>
        本网站本着开放、交流、免费、共同建设的原则，是为了服务各位太太更好追踪榜单数据，<strong>与CP官方没有任何关系.</strong> <br>
       
    </p>
    <p>
        <li>即将上线的功能：1. 日榜中加入一周数据，显示星期【完成】； 2. 其他BL类型数据库【完成】</li>
        <li>在不久的将来会上线的功能： 榜单线表格【完成】，历史数据图表分析</li>
        <li>会上线的功能：查询某ID更新榜单当天的数据</li>
        <li>在将来会上线的功能：互动表格完善书架数据（书架属于APP端登录才可获得的数据， I am thinking about it）</li>
        <li>在将来的将来会上线的功能：留言板</li>
    </p>   
    <p>
        本站正在测试中，属实是被长佩气到了一怒之下怒了一下的工作。 所有功能都在调试。【不保证稳定，不保证更新】。后续会把可以加上的database都加上。如有问题，敬请发送邮件至：
        <a href="mailto:jingerfish.stories@gmail.com">jingerfish.stories@gmail.com</a> </li>
    <!-- Daily Data (Best Sellers) - Appears at the Top -->
     </p> 
    
    <h2 class="mt-5 text-primary">📖 播报</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="broadcast"></tbody>
    </table>

        <h2 class="mt-5 text-success">📌 播报线一周数据</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>更新日</th>
                <th>数据更新时间</th>        
            </tr>
        </thead>
        <tbody id="bobaolishi"></tbody>
    </table>


    
    <!-- Daily Data (Best Sellers) - Appears at the Top -->
    <h2 class="mt-5 text-primary">📖 必读</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="bidu"></tbody>
    </table>

    <h2 class="mt-5 text-success">📌 必读线一周数据</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>更新日</th>
                <th>数据更新时间</th>        
            </tr>
        </thead>
        <tbody id="bidulishi"></tbody>
    </table>
    
    <h2 class="mt-5 text-primary">📖 首页榜单线 </h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>榜单名称</th>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="sybd"></tbody>
    </table>

    <h2 class="mt-5 text-primary">📖 纯爱内页榜单线 </h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>榜单名称</th>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="canybd"></tbody>
    </table>

    <!-- Daily Data (Best Sellers) - Appears at the Top -->
    <h2 class="mt-5 text-primary">📖 本周强推</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="qiangtui"></tbody>
    </table>

    <!-- Daily Data (Best Sellers) - Appears at the Top -->
    <h2 class="mt-5 text-primary">📖 纯爱淘金</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="catj"></tbody>
    </table>

    <!-- Daily Data (Best Sellers) - Appears at the Top -->
    <h2 class="mt-5 text-primary">📖 纯爱淘金-涨幅</h2>
    <table class="table table-striped">
        <thead>
                <th>ID</th>
                <th>书名</th>
                <th>当前热度</th>
                <th>当前收藏</th>
                <th>增加热度</th>
                <th>增加收藏</th>
                <th>初始时间</th>
                <th>截止时间</th>
            </tr>
        </thead>
        <tbody id="catj_delta"></tbody>
    </table>


    <!-- Daily Data (Best Sellers) - Appears at the Top -->
    <h2 class="mt-5 text-primary">📖 人气佳作</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="rqjz"></tbody>
    </table>

    <!-- Daily Data (Best Sellers) - Appears at the Top -->
    <h2 class="mt-5 text-primary">📖 纯爱首页 - 现代</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="casyxd"></tbody>
    </table>

    <h2 class="mt-5 text-primary">📖 纯爱首页 - 古代</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="casygd"></tbody>
    </table>

    <h2 class="mt-5 text-primary">📖 纯爱首页 - 悬疑</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="casyxy"></tbody>
    </table>

    <h2 class="mt-5 text-primary">📖 纯爱首页 - 架空</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="casyjk"></tbody>
    </table>

    <h2 class="mt-5 text-primary">📖 纯爱首页 - 幻想</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="casyhx"></tbody>
    </table>
    
    
    <h2 class="mt-5 text-primary">🔍 查询小说信息</h2>
    <div class="mb-3">
        <label for="searchInput" class="form-label">输入小说ID:</label>
        <input type="text" id="searchInput" class="form-control" placeholder="输入ID后点击查询">
        <button class="btn btn-primary mt-2" onclick="searchID()">🔍 查询</button>
    </div>

    <!-- Display Search Result -->
    <h3 class="mt-4">📖 查询结果:</h3>
    <div id="searchResult" class="alert alert-info" style="display:none;"></div>


    
    <!-- Weekly Data (New Releases) -->
    <h2 class="mt-5 text-success">📚 全站</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>书名</th>
                <th>热度</th>
                <th>收藏</th>
                <th>数据更新时间</th>
            </tr>
        </thead>
        <tbody id="allbooks"></tbody>
    </table>

    <script>
        function getWeekday(timestamp) {
            let date = new Date(timestamp); // Convert timestamp to Date object
            let weekdays = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"];
            return weekdays[date.getDay()]; // Get the weekday in Chinese
        }

        
        // Function to load and display dataset
    async function loadDataset(jsonFile, tableId, showBoth = false) {
        try {
            const response = await fetch(jsonFile);
            const data = await response.json();
            let tableBody = document.getElementById(tableId);
            tableBody.innerHTML = "";  // Clear previous data
    
            data.forEach(row => {
                let weekday = getWeekday(row.Timestamp); // Convert timestamp to weekday
                let displayColumn = showBoth 
                    ? `<td>${weekday}</td><td>${row.Timestamp}</td>`  // ✅ Show both weekday & timestamp
                    : `<td>${row.Timestamp}</td>`;  // ✅ Show only timestamp
    
                let tr = document.createElement("tr");
                tr.innerHTML = `<td>${row.ID}</td>
                                <td>${row.Name}</td>
                                <td>${row.Popularity}</td>
                                <td>${row.Collection}</td>
                                ${displayColumn}`;
                tableBody.appendChild(tr);
            });
        } catch (error) {
            console.error(`Error loading ${jsonFile}:`, error);
        }
    }

    async function loadDataset_ny(jsonFile, tableId) {
        try {
            const response = await fetch(jsonFile);
            const data = await response.json();
            let tableBody = document.getElementById(tableId);
            tableBody.innerHTML = "NULL";  // Clear previous data
    
            data.forEach(row => {    
                let tr = document.createElement("tr");
                tr.innerHTML = `<td>${row.rank_name}</td>
                                <td>${row.ID}</td>
                                <td>${row.Name}</td>
                                <td>${row.Popularity}</td>
                                <td>${row.Collection}</td>
                                <td>${row.Timestamp}</td>
                                `;
                tableBody.appendChild(tr);
            });
        } catch (error) {
            console.error(`Error loading ${jsonFile}:`, error);
        }
    }
    async function loadDataset_increase(jsonFile, tableId, showBoth = false) {
    try {
        const response = await fetch(jsonFile);
        const data = await response.json();
        let tableBody = document.getElementById(tableId);
        tableBody.innerHTML = "";  // Clear previous data

        data.forEach(row => {
            let weekday = getWeekday(row.Timestamp); // Convert timestamp to weekday
            let displayColumn = showBoth 
                ? `<td>${weekday}</td><td>${row.Timestamp}</td>`  // ✅ Show both weekday & timestamp
                : `<td>${row.Timestamp}</td>`;  // ✅ Show only timestamp
            let weekday = getWeekday(row.OldTimestamp); // Convert timestamp to weekday
            let displayColumnOld = showBoth 
                ? `<td>${weekday}</td><td>${row.OldTimestamp}</td>`  // ✅ Show both weekday & timestamp
                : `<td>${row.OldTimestamp}</td>`;  // ✅ Show only timestamp
            let tr = document.createElement("tr");
            tr.innerHTML = `<td>${row.ID}</td>
                            <td>${row.Name}</td>
                            <td>${row.Popularity}</td>
                            <td>${row.Collection}</td>
                             <td>${row.DeltaPopularity}</td>
                            <td>${row.DeltaCollection}</td>
                            <td>${row.OldTimestamp}</td>
                            ${displayColumnOld}
                            ${displayColumn}`;
            tableBody.appendChild(tr);
        });
    } catch (error) {
        console.error(`Error loading ${jsonFile}:`, error);
    }
}

        // Load all datasets when the page loads
        loadDataset("bobao.json", "broadcast");  // Daily data on top
        loadDataset("bidu.json", "bidu");  // Daily data on top
        loadDataset("benzhouqiangtui.json", "qiangtui");  // Daily data on top
        loadDataset("chunaitaojin.json", "catj");  // Weekly data
        loadDataset("renqijiazuo.json", "rqjz");  // Weekly data
        loadDataset("syxd.json", "casyxd");  // Weekly data
        loadDataset("syjk.json", "casyjk");  // Weekly data
        loadDataset("syhx.json", "casyhx");  // Weekly data
        loadDataset("sygd.json", "casygd");  // Weekly data
        loadDataset("syjk.json", "casyjk");  // Weekly data
        loadDataset("syxy.json", "casyxy");  // Weekly data
        loadDataset("bobao_weekly.json", "bobaolishi", true);  // Weekly data
        loadDataset("bidu_weekly.json", "bidulishi", true);  // Weekly data
        loadDataset_ny("canybd.json", "canybd");  // Weekly data
        loadDataset_ny("sybd.json", "sybd");  // Weekly data
        loadDataset_increase('chunaitaojin_increase.json','catj_delta'); 
        loadDataset("output_data.json", "allbooks");  // Weekly data    
    </script>

    <script>
        let jsonData = [];

        // ✅ Load data.json when the page loads
        async function loadData() {
            try {
                const response = await fetch("output_data.json");
                jsonData = await response.json();
            } catch (error) {
                console.error("❌ 数据加载失败:", error);
            }
        }

        // ✅ Function to search for ID
        function searchID() {
            const inputID = document.getElementById("searchInput").value.trim();
            const resultDiv = document.getElementById("searchResult");

            // ❌ If input is empty
            if (!inputID) {
                resultDiv.style.display = "block";
                resultDiv.innerHTML = "⚠️ 请输入一个 ID 进行查询!";
                return;
            }

            // 🔎 Search for the ID
            const foundItem = jsonData.find(item => item.ID == inputID);

            // ✅ Show result or error message
            if (foundItem) {
                resultDiv.style.display = "block";
                resultDiv.innerHTML = `
                    <strong>📚 书名:</strong> ${foundItem.Name} <br>
                    <strong>🔥 热度:</strong> ${foundItem.Popularity} <br>
                    <strong>📂 收藏:</strong> ${foundItem.Collection} <br>
                    <strong>📅 更新时间:</strong>${foundItem.Timestamp}<br> 
                `;
            } else {
                resultDiv.style.display = "block";
                resultDiv.innerHTML = "❌ 未找到匹配的 ID!";
            }
        }

        // ✅ Load JSON on startup
        loadData();
    </script>

<script>
    let novelData = []; // Store novel JSON data
    let savedQueries = {}; // Store queries in localStorage
    let isEditingEnabled = false; // Flag for edit mode

    // ✅ Fetch Novel Data on Page Load
    async function fetchNovelData() {
        try {
            const response = await fetch("output_data.json");
            novelData = await response.json();
            console.log("✅ 数据加载成功!");
        } catch (error) {
            console.error("❌ 数据加载失败:", error);
        }
    }

    // ✅ Load Previously Saved Queries from localStorage
    function loadSavedQueries() {
        let storedData = localStorage.getItem("savedQueries");
        savedQueries = storedData ? JSON.parse(storedData) : {};
    }

    // ✅ Save Queries to localStorage
    function saveQueries() {
        localStorage.setItem("savedQueries", JSON.stringify(savedQueries));
    }

    // ✅ Create a 10-row × 7-column Table
    function createQueryTable() {
        const table = document.getElementById("queryTable");

        for (let i = 0; i < 10; i++) {
            let trInput = document.createElement("tr");
            let trOutput = document.createElement("tr");

            trInput.innerHTML = `<th class="text-center">${i + 1}</th>`; // Row index
            trOutput.innerHTML = `<td class="text-center table-light"><strong>🔎 结果</strong></td>`; // Row header for results

            for (let j = 0; j < 7; j++) {
                let index = i * 7 + j; // Unique index for each cell
                let savedID = savedQueries[`input-${index}`] || ""; // Load stored ID if available
                let savedResult = savedQueries[`output-${index}`] || "NULL"; // Load stored result if available

                // Row 1: Input Fields & Buttons (Initially Disabled)
                trInput.innerHTML += `<td class="p-2">
                                        <div class="input-group">
                                            <input type="text" class="form-control form-control-sm" id="novel-input-${index}" placeholder="输入ID" value="${savedID}" disabled>
                                            <button class="btn btn-outline-primary btn-sm" onclick="queryNovelID(${index})" disabled>🔍</button>
                                        </div>
                                    </td>`;

                // Row 2: Query Output
                trOutput.innerHTML += `<td id="novel-output-${index}" class="text-danger small p-2">${savedResult}</td>`;
            }

            table.appendChild(trInput);
            table.appendChild(trOutput);
        }
    }

    // ✅ Search for ID and Update the Current Cell Only
    function queryNovelID(index) {
        let inputElement = document.getElementById(`novel-input-${index}`);
        let outputCell = document.getElementById(`novel-output-${index}`);
        let inputID = inputElement.value.trim();

        outputCell.innerHTML = "NULL"; // Default to "NULL"

        if (!inputID) return; // Do nothing if input is empty

        let foundItem = novelData.find(item => item.ID == inputID);

        if (foundItem) {
            outputCell.innerHTML = `<strong>📖 ${foundItem.Name}</strong><br>📂 收藏: ${foundItem.Collection} | 🔥 热度: ${foundItem.Popularity}`;
        }

        // ✅ Save Input and Output to localStorage
        savedQueries[`input-${index}`] = inputID;
        savedQueries[`output-${index}`] = outputCell.innerHTML;
        saveQueries();
    }

    // ✅ Unlock Editing Mode (Requires Password)
    function unlockEditing() {
        let password = prompt("🔑 请输入密码:");
        if (password !== "changpeijintiandaobilema") {
            alert("❌ 密码错误!");
            return;
        }

        isEditingEnabled = true;
        let inputs = document.querySelectorAll('input[type="text"]');
        let buttons = document.querySelectorAll('button.btn-outline-primary');

        inputs.forEach(input => input.removeAttribute("disabled"));
        buttons.forEach(button => button.removeAttribute("disabled"));

        alert("✅ 你现在可以编辑表格!");
    }

    // ✅ Lock Editing Mode (Prevent Further Changes)
    function lockEditing() {
        isEditingEnabled = false;
        let inputs = document.querySelectorAll('input[type="text"]');
        let buttons = document.querySelectorAll('button.btn-outline-primary');

        inputs.forEach(input => input.setAttribute("disabled", true));
        buttons.forEach(button => button.setAttribute("disabled", true));

        alert("🔒 表格已锁定!");
    }

    // ✅ Initialize Table, Load Data, and Restore Previous Searches
    loadSavedQueries(); // Load previous queries
    createQueryTable();
    fetchNovelData();

    <h2 class="mt-5 text-primary">🔍 查询书架信息 (7行×10列)</h2>
// <!-- Edit Controls -->
// <div class="mb-3">
//     <button class="btn btn-success" onclick="unlockEditing()">🔓 开始修改书架</button>
//     <button class="btn btn-danger" onclick="lockEditing()">🔒 书架修改完成</button>
// </div>
// <!-- Query Table (10 rows × 7 columns) -->
// <table class="table table-bordered">
//     <thead>
//         <tr class="table-light text-center">
//             <th>#</th> <!-- Row index -->
//             <th>星期一</th> <th>星期二</th> <th>星期三</th> <th>星期四</th>
//             <th>星期五</th> <th>星期六</th> <th>星期日</th>
//         </tr>
//     </thead>
//     <tbody id="queryTable"></tbody>
// </table>
</script>
</body>
</html>
